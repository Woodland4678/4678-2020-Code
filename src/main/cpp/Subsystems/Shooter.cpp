// RobotBuilder Version: 2.0
//
// This file was generated by RobotBuilder. It contains sections of
// code that are automatically generated and assigned by robotbuilder.
// These sections will be updated in the future when you export to
// C++ from RobotBuilder. Do not put any code or make any change in
// the blocks indicating autogenerated code or it will be lost on an
// update. Deleting the comments indicating the section will prevent
// it from being updated in the future.


#include "Subsystems/Shooter.h"
// BEGIN AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=INCLUDES

    // END AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=INCLUDES

// BEGIN AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=CONSTANTS

    // END AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=CONSTANTS

    //Shooter PID values
    const double shooter_P = 0.5;
    const double shooter_I = 0;
    const double shooter_D = 0;

    const double hood_P = 0.5;
    const double hood_I = 0;
    const double hood_D = 0;

    const double hoodLowPos = 0;
    const double hoodMedPos = 0;
    const double hoodHighPos = 0;

    //acceptable hood error from target position
    const double acceptableError = 100; //change later

Shooter::Shooter() : frc::Subsystem("Shooter") {
    // BEGIN AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=DECLARATIONS
shooterMotor1.reset(new WPI_TalonSRX(9));


shooterMotor2.reset(new WPI_TalonSRX(10));


shooterMotor3.reset(new WPI_TalonSRX(11));


shooterMotor4.reset(new WPI_TalonSRX(12));


hoodMotor.reset(new WPI_TalonSRX(15));


hoodLock.reset(new frc::Solenoid(0, 2));
AddChild("hoodLock", hoodLock);


    // END AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=DECLARATIONS
    // Slavery of the motors
    shooterMotor2->Follow(*shooterMotor1);
    shooterMotor3->Follow(*shooterMotor1);
    shooterMotor4->Follow(*shooterMotor1);
    // setting PID values of master
    shooterMotor1->Config_kP(0,shooter_P);
    shooterMotor1->Config_kI(0,shooter_I);
    shooterMotor1->Config_kD(0,shooter_D);

    hoodMotor->Config_kP(0,hood_P);
    hoodMotor->Config_kI(0,hood_I);
    hoodMotor->Config_kD(0,hood_D);
    
    hoodMotor->ConfigSelectedFeedbackSensor(FeedbackDevice::QuadEncoder,0);
    hoodMotor->SetSelectedSensorPosition(0);
}

void Shooter::InitDefaultCommand() {
    // Set the default command for a subsystem here.
    // SetDefaultCommand(new MySpecialCommand());
    // BEGIN AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=DEFAULT_COMMAND


    // END AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=DEFAULT_COMMAND
}

void Shooter::Periodic() {
    // Put code here to be run every loop

}

// BEGIN AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=CMDPIDGETTERS

    // END AUTOGENERATED CODE, SOURCE=ROBOTBUILDER ID=CMDPIDGETTERS


// Put methods for controlling this subsystem
// here. Call these from Commands.

void Shooter::SetShooterSpeed(double speed) {
    //shooterMotor1->Set(ControlMode::PercentOutput,speed);
    shooterMotor1->Set(speed);
}

void Shooter::stopShooter(){
    shooterMotor1->Disable();
}

/*
void Shooter::hoodLow(){
    hoodMotor->Set(ControlMode::Position,hoodLowPos);
    targetPos = hoodLowPos;
}

void Shooter::hoodMedium(){
    hoodMotor->Set(ControlMode::Position,hoodMedPos);
    targetPos = hoodMedPos;
}

void Shooter::hoodHigh(){
    hoodMotor->Set(ControlMode::Position,hoodHighPos);
    targetPos = hoodHighPos;
}
*/

bool Shooter::goToHoodPos(double target){
    releaseHood();
    if (delayCount > 10) {
        hoodMotor->Set(ControlMode::Position,target);
        hoodTargetPos = target;
        if(findHoodError() <= acceptableError){
            count++;
        } else {count = 0;}
        if(count >= 10){
            lockHood();
            count = 0;
            delayCount = 0;
            return true;
        }
    }
    delayCount++;
    return false;
}

double Shooter::readEncoderPos(){
    return hoodMotor->GetSelectedSensorPosition();
}

void Shooter::lockHood(){
    hoodLock->Set(true);
}

void Shooter::releaseHood(){
    hoodLock->Set(false);
}

double Shooter::findHoodError(){
    return hoodTargetPos - readEncoderPos();
}

void Shooter::configHoodTarget(double target){
    hoodTargetPos = target;
}

void Shooter::configAimTarget(double target){
    autoAimTarget = target;
}

void Shooter::configShootVel(double target){
    shootTargetVel = target;
}

double Shooter::getHoodTarget(){
    return hoodTargetPos;
}

double Shooter::getAimTarget(){
    return autoAimTarget;
}

double Shooter::getTargetShootVel(){
    return shootTargetVel;
}

double Shooter::getShooterVel(){
    return shooterMotor1->GetSelectedSensorVelocity();
}

